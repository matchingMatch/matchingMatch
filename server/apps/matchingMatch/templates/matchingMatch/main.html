{% extends 'matchingMatch/base.html' %}
{%load static%}
{% block content %}
<body>
	<div class="alarm_modal_list"></div>
	<main class="wrap w-100% d-flex bg-light justify-content-center p-0">
		<div class = "main_container d-flex flex-column bg-white">
			<div class="banner p-2">
				<img src="{%static 'image/banner_photo.jpg' %}" alt="banner_image">
			</div>
			<div class="plans_mode">
				<div class="mode">
					<img src="{% static 'icon/arrows-left-right-solid.svg' %}" alt="슬라이드"> <input type="radio" value="week_slideshow" name="mode" id="slide" checked>
				</div>
				<div class="mode">
					<img src="{% static 'icon/calendar-solid.svg' %}" alt="캘린더"> <input type="radio" value="calendar_container" name="mode" id="calendar" >
				</div>
			</div>
			<div class="calendar_container sticky-top">
				<div class="calendar_header">
				<div class="year_month"></div>
				<div class="nav">
					<button class="nav_btn go_prev">&lt;</button>
					<button class="nav_btn go_today">Today</button>
					<button class="nav_btn go_next">&gt;</button>
				</div>
				</div>
				<div class="calendar">
				<div class="days">
					<div class="day">일</div>
					<div class="day">월</div>
					<div class="day">화</div>
					<div class="day">수</div>
					<div class="day">목</div>
					<div class="day">금</div>
					<div class="day">토</div>
				</div>
				<!-- 날짜 영역 -->
				<div class="dates">
				</div>
				</div>
			</div>
			<div class="week_slideshow sticky-top">
				<ul class="week">
					<li class="date">
						<div>x요일</div>
						<div>x일</div>
					</li>
				</ul>
				<p class="controller">
				<span class="prev">&lang;</span>
				<span class="next">&rang;</span>
				</p>
			</div>
			
			<div class="filter_register d-flex">
				<div class="match_filter container ">
					<button 
						class="btn btn-primary"
						type="button"
						data-bs-toggle="collapse"
						data-bs-target="#matchFilter"
						aria-expanded="true"
						aria-controls="matchFilter">
						상세설정
					</button>
					<button class="match_register_btn btn btn-success ">
						<a href="{% url 'matchingMatch:match_register'%}" style="text-decoration:none; color:white;">
								매치 등록하기
						</a>
					</button>
					<form action="" method="get">
					<div id="matchFilter" class="collapse">
						<div class="container">
							<p>지역</p>
							<div id = "regions" class = "row">
								{%for region in filter_form.region%}
								<div class = "col-2">{{region}}</div>
								{%endfor%}
							</div>
							<button type = 'button' class = "btn btn-primary" id = "region-all-check">전체 선택</button>
							<button type = 'button' class = "btn btn-primary" id = "region-all-cancel">전체 선택 해제</button>
							<div>
								<b>마감 여부</b>
							<select name="is_matched" >
								{% for option in filter_form.is_matched%}
								{{option}}
								{%endfor%}
							</select>
							</div>
							<div>
								<b>성별</b>
								{{filter_form.gender}}
							</div>
							<input class = "btn btn-outline-info" type="submit" value = "확인">
						</div>
					</form>
				</div>
			</div>
			<div class="match_list d-flex flex-column flex-nowrap align-items-center">
				{% for match in matches %}
				<a href="{% url 'matchingMatch:match_detail' match.pk%}" style="text-decoration:none" class="w-100">
					<div class="list-group-item d-flex  p-2 text-black border-bottom align-items-center justify-content-center" >
						<div class="time-wrap btn btn-warning h-50" style="font-size: 12px;">
							{{ match.date|date:"M d" }}일
							<br>
							{{match.start_time}}
						</div>
						<div class="info-wrap col-6 p-3"  >
							<div class="match-wrap" >
								{{match.stadium.stadium_name}}
								<br>
								{{match.get_gender_display}}
							</div>
								{% if match.is_matched %}
								<div>
									{{match.host_id.team_name}} vs {{match.participant_id.team_name}}
								</div>
								{% else %}
								<div>
									{{match.host_id.team_name}}
								</div>
								{%endif%}
						</div>
						<div class ="host-wrap">
							{% if match.is_matched %}
							<div class="btn btn-primary d-flex justify-content-center align-items-center py-3 " style="font-size: 12px; width:80px;">
									<div>매치성사</div>
								</div>
							{% else %}
							<div class="btn btn-danger d-flex justify-content-center align-items-center py-3 " style="font-size: 12px; width:80px;">
									<div>찾는 중</div>
								</div>
							{% endif %}
						</div>
					</div>	
				</a>
				{% endfor %}
			</div>
			
		</div>
	</main>
</body>
{%endblock%}
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
		crossorigin="anonymous"
	></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script>
    const checkMode = (e, theother) => {
      document.querySelector(`.${e.target.value}`).style.display = 'block'
      document.querySelector(`.${theother}`).style.display = 'none'
    }
    const slideModeBtn = document.querySelector('#slide')
    const calendarModeBtn = document.querySelector('#calendar')
    slideModeBtn.addEventListener('click', (e) => checkMode(e, 'calendar_container'))
    calendarModeBtn.addEventListener('click', (e) => checkMode(e, 'week_slideshow'))
		
		const sendRequest = async () => {
			const url = "/match/ended/";
			let userMatches = await axios.get(url);
			userMatches = userMatches.data.userMatches;
			console.log("userMatches:", userMatches);
			createModal(userMatches);
		};
		document.querySelector("header h1").addEventListener("click", sendRequest);

		sendRequest();
		window.setInterval(sendRequest, 10000); //30분마다 Ajax 요청

		const createModal = (userMatches) => {
			const alarmModalList = document.querySelector(".alarm_modal_list");
			alarmModalList.innerHTML = "";
			for (let i = 0; i < userMatches.length; i++) {
				match = userMatches[i];
				alarmModalList.innerHTML += `
      <div class="alarm_modal" id="${i}">
        <div>${match.host_teamname} VS ${match.participant_teamname}</div>
        <div>경기 종료 시간: ${match.end_time}</div>
        <div>즐거운 경기 되셨나요? 수고한 상대팀에게 좋은 점수 부탁드려요!</div>
        <form action="/rate/${match.match_id}" method="post">
          {% csrf_token %}
          <label>실력: <input name="level" type="number" max="10"></label>
          <label>매너: <input name="manner" type="number" max="10"></label>
          <div class="rate_save">
            <input type="submit" value="완료">
          </div>
        </form>
      </div>
      `;
			}
		};
		
		const regionAllCheck = document.getElementById("region-all-check")
		const regionAllCancel = document.getElementById("region-all-cancel")
		
		regionAllCheck.addEventListener('click', () => {
			const checkboxes = document.getElementsByName('region')
			checkboxes.forEach((checkbox) => {
				checkbox.checked = true
			}) 
		})

		regionAllCancel.addEventListener('click', () => {
			const checkboxes = document.getElementsByName('region')
			checkboxes.forEach((checkbox) => {
				checkbox.checked = false
			}) 
		})
 
	</script>
