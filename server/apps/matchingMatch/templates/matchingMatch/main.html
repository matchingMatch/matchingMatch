{% load static %}
<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="{% static 'css/main.css' %}" />
		<!-- CSS only -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
			crossorigin="anonymous"
		/>
    <script defer src="{% static 'js/calendar.js' %}"></script>
    <script defer src="{% static 'js/mainslide.js' %}"></script>
		<!-- JavaScript Bundle with Popper -->

		<title>매칭매치</title>
	</head>
	<body>
		{% include 'matchingMatch/navbar.html' %}
		<header>
			<h1>Matching Match</h1>
			<h1>매칭매치</h1>
			<div class="alarm_modal_list"></div>
		</header>

		<main>
      <div class="plans_mode">
        <label>슬라이드 <input type="radio" value="week_slideshow" name="mode" id="slide" checked></label>
        <label>캘린더 <input type="radio" value="calendar_container" name="mode" id="calendar" ><label>
      </div>
      <div class="calendar_container">
        <div class="calendar_header">
          <div class="year_month"></div>
          <div class="nav">
            <button class="nav_btn go_prev">&lt;</button>
            <button class="nav_btn go_today">Today</button>
            <button class="nav_btn go_next">&gt;</button>
          </div>
        </div>
        <div class="calendar">
          <div class="days">
            <div class="day">일</div>
            <div class="day">월</div>
            <div class="day">화</div>
            <div class="day">수</div>
            <div class="day">목</div>
            <div class="day">금</div>
            <div class="day">토</div>
          </div>
          <!-- 날짜 영역 -->
          <div class="dates">
          </div>
        </div>
      </div>
			<div class="week_slideshow">
				<ul class="week">
					<li class="date">
						<div>x요일</div>
						<div>x일</div>
					</li>
				</ul>
        <p class="controller">
          <span class="prev">&lang;</span>
          <span class="next">&rang;</span>
        </p>
			</div>

			<button name="gender" data-toggle="false" data value data-type="female">
				여성
			</button>
			<div class="match_filter container">
				<button
					class="btn btn-primary"
					type="button"
					data-bs-toggle="collapse"
					data-bs-target="#matchFilter"
					aria-expanded="true"
					aria-controls="matchFilter"
				>
					상세설정
				</button>
				<form action="" method="get">
				<div id="matchFilter" class="collapse">
					<div class="container">
						<p>지역</p>
						<div class = "row">
			
							{%for region in filter_form.region%}
							<div class = "col-2">{{region}}</div>
							{%endfor%}
						</div>
						<div>
							<b>마감 여부</b>
						<select name="is_matched" >
							{% for option in filter_form.is_matched%}
							{{option}}
							{%endfor%}
						</select>
						</div>
						<div>
							<b>성별</b>
							{{filter_form.gender}}
						</div>
						<input class = "btn btn-primary" type="submit" value = "확인">
					</div>
				</form>
					<!-- <div class="gender">
						<b>성별</b>
						<button name="gender" data-toggle="true" data value data-type="all">
							전체
						</button>
						<button
							name="gender"
							data-toggle="false"
							data
							value
							data-type="male"
						>
							남성
						</button>
						<button
							name="gender"
							data-toggle="false"
							data
							value
							data-type="female"
						>
							여성
						</button>
						<button
							name="gender"
							data-toggle="false"
							data
							value
							data-type="mixed"
						>
							혼성
						</button>
					</div>
					<div class="region">
						<b>지역</b>
						<button name="gender" data-toggle="true" data value data-type="all">
							전체
						</button>
						<button
							name="gender"
							data-toggle="false"
							data
							value
							data-type="westnorth"
						>
							서북권
						</button>
						<button
							name="gender"
							data-toggle="false"
							data
							value
							data-type="middlenorth"
						>
							도심권
						</button>
						<button
							name="gender"
							data-toggle="false"
							data
							value
							data-type="eastnorth"
						>
							동북권
						</button>
						<button
							name="gender"
							data-toggle="false"
							data
							value
							data-type="westsouth"
						>
							서남권
						</button>
						<button
							name="gender"
							data-toggle="false"
							data
							value
							data-type="eastsouth"
						>
							동남권
						</button>
					</div>
					<div class="is_matched">
						<b>마감 여부</b>
						<button name="gender" data-toggle="true" data value data-type="all">
							전체
						</button>
						<button
							name="gender"
							data-toggle="false"
							data
							value
							data-type="is_not_matched"
						>
							마감 안됨
						</button>
					</div>
					<div class="time">
						<b>시간</b>
						<button name="time" data-toggle="true" data value data-type="all">
							전체
						</button>
						<button
							name="time"
							data-toggle="false"
							data
							value
							data-type="beforenoon"
						>
							오전
						</button>
						<button
							name="time"
							data-toggle="false"
							data
							value
							data-type="afternoon"
						>
							오후 12시~6시
						</button>
						<button
							name="time"
							data-toggle="false"
							data
							value
							data-type="night"
						>
							오후 6시 이후
						</button>
					</div>
				</div> -->
			</div>

			<ul class="match_list">
				{% for match in matches %}
				<a href="{% url 'matchingMatch:match_detail' match.pk%}">
					<div>{{match.start_time}} ~ {{match.end_time}}</div>
					<div>
						축구장 : {{match.stadium.stadium_name}}
						<br />성별 : {{match.get_gender_display}}
					</div>
					<div>
						{% if match.is_matched %}
						<div>
							{{match.host_id.team_name}} vs {{match.participant_id.team_name}}
						</div>
						<div>매치성사</div>
						<br />
						{% else %}
						<div>{{match.host_id.team_name}}</div>
						<div>찾는 중</div>
						<br />
						{% endif %}
					</div>
				</a>
				{% endfor %}
			</ul>
			<div class="match_register_btn">
				<a href="{% url 'matchingMatch:match_register'%}">매치 등록하기</a>
			</div>
		</main>
	</body>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
		crossorigin="anonymous"
	></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script>
    const checkMode = (e, theother) => {
      document.querySelector(`.${e.target.value}`).style.display = 'block'
      document.querySelector(`.${theother}`).style.display = 'none'
    }
    const slideModeBtn = document.querySelector('#slide')
    const calendarModeBtn = document.querySelector('#calendar')
    slideModeBtn.addEventListener('click', (e) => checkMode(e, 'calendar_container'))
    calendarModeBtn.addEventListener('click', (e) => checkMode(e, 'week_slideshow'))
		
		const sendRequest = async () => {
			const url = "/match/ended/";
			let userMatches = await axios.get(url);
			userMatches = userMatches.data.userMatches;
			console.log("userMatches:", userMatches);
			createModal(userMatches);
		};
		document.querySelector("header h1").addEventListener("click", sendRequest);

		sendRequest();
		window.setInterval(sendRequest, 10000); //30분마다 Ajax 요청

		const createModal = (userMatches) => {
			const alarmModalList = document.querySelector(".alarm_modal_list");
			alarmModalList.innerHTML = "";
			for (let i = 0; i < userMatches.length; i++) {
				match = userMatches[i];
				alarmModalList.innerHTML += `
      <div class="alarm_modal" id="${i}">
        <div>${match.host_teamname} VS ${match.participant_teamname}</div>
        <div>경기 종료 시간: ${match.end_time}</div>
        <div>즐거운 경기 되셨나요? 수고한 상대팀에게 좋은 점수 부탁드려요!</div>
        <form action="/rate/${match.match_id}" method="post">
          {% csrf_token %}
          <label>실력: <input name="level" type="number" max="10"></label>
          <label>매너: <input name="manner" type="number" max="10"></label>
          <div class="rate_save">
            <input type="submit" value="완료">
          </div>
        </form>
      </div>
      `;
			}
		};
	</script>
</html>
